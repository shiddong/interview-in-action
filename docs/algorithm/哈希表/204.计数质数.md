---
title: 204.计数质数
author: shiddong
---

## 题目

### 描述

统计所有小于非负整数 n 的质数的数量。

> 名称: [计数质数](https://leetcode-cn.com/problems/count-primes/)
>
> 难度: 简单

### 示例

```js
输入: 10
输出: 4

解释: 小于 10 的质数一共有 4 个, 它们是 2, 3, 5, 7 。
```

### 说明

质数，又称素数，是一个只能被 1 和它自己整除的整数，即它只有两个因数—— 1 和它本身。

比如 3 是一个素数，因为 3 只能被 1 和 3 整除，但是 6 不是素数因为它能被 2 和 3 整除。

迄今为止发现的最大的素数是 2<sup>57885161</sup> - 1，由中央密苏里大学的数学家 Curtis Cooper 发现，大概有 17,425,170 位数字。

## 解答

### 方法：使用埃拉托斯托尼筛选法

> 以下方式可以解出答案，但全遍历会导致超出时间限制

```js
/**
 * @param {number} n
 * @return {number}
 */
const countPrimes = function(n) {
  if (n <= 2) {
    return 0;
  }
  // 创建一个boolean数组，也是最终的结果
  let list = new Array(n).fill(true, 0, n);

  for (let i = 2; i <= n; i++) {
    for (let j = i + 1; j <= n; j++) {
      if (j % i === 0) {
        list[j] = false;
      }
    }
  }

  return list.filter((elem) => elem).length - 2;
};
```

### 优化 1：剔除已计算过的数，同时使用平方根加快计算

这个执行时间还是太长，达到 1000ms 以上。

```js{8-10,12}
const countPrimes = function(n) {
  if (n <= 2) {
    return 0;
  }
  let list = new Array(n).fill(true, 0, n);

  for (let i = 2; i <= n; i++) {
    if (!list[i]) {
      continue;
    }

    for (let j = i * i; j <= n; j++) {
      if (j % i === 0) {
        list[j] = false;
      }
    }
  }

  return list.filter((elem) => elem).length - 2;
};
```

### 优化 2：

```js
const countPrimes = function(n) {
  if (n <= 2) {
    return 0;
  }
  let list = new Array(n).fill(true, 0, n);

  for (let i = 2; i <= n; i++) {
    if (!list[i]) {
      continue;
    }

    for (let j = i * i; j <= n; j++) {
      if (j % i === 0) {
        list[j] = false;
      }
    }
  }

  return list.filter((elem) => elem).length - 2;
};
```

## 背景知识

素数这个概念人类已经研究了上千年，但是的具体的起源却不得而知。早在公元前 300 年，欧几里得就在他的著作元素中证明了有无穷多个素数，同时也证明了任何一个整数都能够被某一个素数整除。时至今日，素数在计算机科学这样一个和数学联系紧密的学科中也有这个广泛的应用，比如**布隆过滤器、伪随机数、RSA 加密算法**等等，所以掌握素数的特性以及应用能够帮助我们解决不少实际问题。

### 埃拉托斯托尼筛选法

在公元前 200 年，古希腊数学家**埃拉托斯托尼（Eratosthenes）**创造了一套算法用来计算素数，这就是大家熟知的埃拉托斯托尼筛选法（the Sieve of Eratosthenes），这是最早的用来计算素数的方法。

就拿 100 以内素数的方法来简单介绍一下这个筛选法：

首先我们找到第一个素数 2，用圆圈标出来，然后划掉所有 2 的倍数 4、6、8 等等。然后我们找到下一个没有被划掉的数字（这个数字肯定不是前面更小数字的倍数），也就是 3，用圆圈标出来，再划掉所有的 3 的倍数，注意这里 6 已经被划掉了，但是 9 可以继续被划掉。接下来再用圆圈标出下一个没有被划掉的数字 5，划掉所有的 5 的倍数。如此往复，直到 100 的平方根 10 截止，所有的 100 以内的素数就都被圆圈圈起来了。

**所以，埃拉托斯特尼筛法的具体内容就是：要得到自然数 n 以内的全部素数，必须把不大于根号 n 的所有素数的倍数剔除，剩下的就是素数。**

### 优化

同时考虑到大于 2 的偶数都不是素数，所以可以进一步优化成：

要得到自然数 n 以内的全部素数，必须把不大于根号 n 的所有素数的奇数倍剔除，剩下的奇数就是素数。

那么思路就很清晰了：

1. 判断 n 是否大于 2，如果大于 2 了那么至少有一个小于 n 的质数 2。
2. 遍历大于 1 小于 n 的所有奇数 i，如果 i 是质数，并且 i 不大于根号 n，那么将 i 的所有奇数倍都标记成合数，如果 i 是质数但是 i 大于根号 n 那么直接转步骤 3。
3. 标记完成后质数个数+1。
4. 循环结束后返回质数个数。
